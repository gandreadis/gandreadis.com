(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{PCNd:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.dynamicSort=function(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,r){return(n[e]<r[e]?-1:n[e]>r[e]?1:0)*t}},e.getCurrentDatum=function(){var e=new Date,t=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0");return e.getFullYear()+"-"+n+"-"+t},e.getCurrentTijd=function(){var e=new Date;return String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")},e}()},ZJFI:function(e,t,n){"use strict";var r=n("mrSG"),i=n("ZZ/e"),o=n("26FU"),s=n("PCNd"),a=n("AytR"),u=function(){function e(e,t){this.sqlitePorter=e,this.sqlite=t,this.cache=a.a.editable?{}:d}return e.prototype.init=function(){var e=this;return a.a.editable?this.sqlite.create({name:"statistak.db",location:"default"}).then(function(t){e.database=t}):new Promise(function(e){return e()})},e.prototype.checkSqlInCache=function(e){var t=this;return new Promise(function(n,r){t.cache[e]?n(t.cache[e]):(console.error("Query",e,"not found"),r())})},e.prototype.run=function(e){var t=this;return a.a.editable?new Promise(function(n,i){return r.b(t,void 0,void 0,function(){var t;return r.e(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.database.executeSql(e)];case 1:return r.sent(),n(),[3,3];case 2:return(t=r.sent()).hasOwnProperty("rows")?n(t):i(t),[3,3];case 3:return[2]}})})}):this.checkSqlInCache(e)},e.prototype.import=function(e){var t=this;return a.a.editable?new Promise(function(n,i){return r.b(t,void 0,void 0,function(){return r.e(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.sqlitePorter.importSqlToDb(this.database,e)];case 1:case 2:return t.sent(),n(),[3,3];case 3:return[2]}})})}):new Promise(function(e){return e()})},e.prototype.exec=function(e){var t=this;return a.a.editable?new Promise(function(n,i){return r.b(t,void 0,void 0,function(){var t,o,s,a;return r.e(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,this.database.executeSql(e,[])];case 1:return t=u.sent(),[3,3];case 2:return(o=u.sent()).hasOwnProperty("rows")?[3,3]:(console.log(o),i(o),[2]);case 3:for(s=[],a=0;a<t.rows.length;a++)s.push(r.a({},t.rows.item(a)));return this.cache[e]=s.slice(),n(s),[2]}})})}):this.checkSqlInCache(e)},e.prototype.execWithVars=function(e,t){for(var n=e,r=0,i=t;r<i.length;r++){var o=i[r],s="string"==typeof o?o.replace(/'/g,"\\'"):o;n=n.replace("?","'"+s+"'")}return this.exec(n)},e.prototype.export=function(){return this.sqlitePorter.exportDbToSql(this.database)},e}(),d={},c=n("0K09"),l=n("6GXZ"),p=n("CcnG"),h=n("t/Na");n.d(t,"a",function(){return f});var f=function(){function e(e,t,n,r){var i=this;this.plt=e,this.http=t,this.sqlitePorter=n,this.sqlite=r,this.dbReady=new o.a(!1),this.optredens=new o.a([]),this.stukken=new o.a([]),this.plt.ready().then(function(){i.sql=new u(n,r),i.sql.init().then(function(){})})}return e.prototype.resetDatabase=function(e){var t=this;this.http.get("assets/db/reset.sql",{responseType:"text"}).subscribe(function(n){t.sql.import(n).then(e).catch(function(e){return console.error(e)})})},e.prototype.seedDatabase=function(){var e=this;this.http.get("assets/db/seed.sql",{responseType:"text"}).subscribe(function(t){e.sql.import(t).then(function(t){e.loadOptredens(),e.loadStukken(),e.dbReady.next(!0)}).catch(function(e){return console.error(e)})})},e.prototype.importDatabase=function(e){var t=this;return this.sql.import(e).finally(function(){t.loadOptredens(),t.loadStukken()})},e.prototype.exportDatabase=function(){return this.sql.export()},e.prototype.getCache=function(){return this.sql.cache},e.prototype.getDatabaseState=function(){return this.dbReady.asObservable()},e.prototype.getOptredens=function(){return this.optredens.asObservable()},e.prototype.getStukken=function(){return this.stukken.asObservable()},e.prototype.loadOptredens=function(){var e=this;return this.sql.exec("SELECT * FROM optreden").then(function(t){return r.b(e,void 0,void 0,function(){var e,n,i;return r.e(this,function(r){switch(r.label){case 0:if(e=[],!(t.length>0))return[3,4];n=0,r.label=1;case 1:return n<t.length?[4,this.getOptredenRepertoire(t[n].id)]:[3,4];case 2:(i=r.sent()).sort(s.a.dynamicSort("code")),e.push({id:t[n].id,locatie:t[n].locatie,plaats:t[n].plaats,landCode:t[n].landCode,longitude:t[n].longitude,latitude:t[n].latitude,datum:t[n].datum,tijd:t[n].tijd,isBuiten:1===t[n].isBuiten,isSociaal:1===t[n].isSociaal,isOpenbaar:1===t[n].isOpenbaar,isBesloten:1===t[n].isBesloten,isWildOp:1===t[n].isWildOp,mansen:1===t[n].mansen,cds:1===t[n].cds,groupies:1===t[n].groupies,aantalBezoekers:t[n].aantalBezoekers,gastdirigent:t[n].gastdirigent,opmerkingen:t[n].opmerkingen,stukken:i}),r.label=3;case 3:return n++,[3,1];case 4:return this.optredens.next(e),[2]}})})})},e.prototype.addOptreden=function(e){var t=this;return this.sql.execWithVars("\n    INSERT INTO optreden (locatie, plaats, landCode, longitude, latitude, datum, tijd, isBuiten,\n    isSociaal, isOpenbaar, isBesloten, isWildOp, mansen, cds, groupies, aantalBezoekers, gastdirigent, opmerkingen)\n    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[e.locatie,e.plaats,e.landCode,e.longitude,e.latitude,e.datum,e.tijd,e.isBuiten?1:0,e.isSociaal?1:0,e.isOpenbaar?1:0,e.isBesloten?1:0,e.isWildOp?1:0,e.mansen?1:0,e.cds?1:0,e.groupies?1:0,e.aantalBezoekers,e.gastdirigent,e.opmerkingen]).then(function(){return r.b(t,void 0,void 0,function(){var t,n,i;return r.e(this,function(r){switch(r.label){case 0:return[4,this.sql.exec("SELECT seq FROM sqlite_sequence WHERE name='optreden'")];case 1:return t=r.sent(),n=t[0].seq,e.stukken.length>0?(i=e.stukken.map(function(e){return"("+n+", "+e.id+")"}).join(", "),[4,this.sql.run("INSERT INTO optreden_repertoire (optredenId, stukId) VALUES "+i)]):[3,3];case 2:r.sent(),r.label=3;case 3:return this.loadOptredens(),[2]}})})})},e.prototype.getOptreden=function(e){var t=this;return this.sql.exec("SELECT * FROM optreden WHERE id = '"+e+"'").then(function(e){return r.b(t,void 0,void 0,function(){var t;return r.e(this,function(n){switch(n.label){case 0:return[4,this.getOptredenRepertoire(e[0].id)];case 1:return(t=n.sent()).sort(s.a.dynamicSort("code")),[2,{id:e[0].id,locatie:e[0].locatie,plaats:e[0].plaats,landCode:e[0].landCode,longitude:e[0].longitude,latitude:e[0].latitude,datum:e[0].datum,tijd:e[0].tijd,isBuiten:1===e[0].isBuiten,isSociaal:1===e[0].isSociaal,isOpenbaar:1===e[0].isOpenbaar,isBesloten:1===e[0].isBesloten,isWildOp:1===e[0].isWildOp,mansen:1===e[0].mansen,cds:1===e[0].cds,groupies:1===e[0].groupies,aantalBezoekers:e[0].aantalBezoekers,gastdirigent:e[0].gastdirigent,opmerkingen:e[0].opmerkingen,stukken:t}]}})})})},e.prototype.deleteOptreden=function(e){var t=this;return this.sql.run("DELETE FROM optreden WHERE id = '"+e+"'").then(function(e){t.loadOptredens()})},e.prototype.updateOptreden=function(e){var t=this;return this.sql.execWithVars("\n    UPDATE optreden SET locatie = ?, plaats = ?, landCode = ?, longitude = ?, latitude = ?, datum = ?, tijd = ?,\n      isBuiten = ?, isSociaal = ?, isOpenbaar = ?, isBesloten = ?, isWildOp = ?, mansen = ?, cds = ?, groupies = ?, aantalBezoekers = ?, gastdirigent = ?, opmerkingen = ?\n      WHERE id = "+e.id,[e.locatie,e.plaats,e.landCode,e.longitude,e.latitude,e.datum,e.tijd,e.isBuiten?1:0,e.isSociaal?1:0,e.isOpenbaar?1:0,e.isBesloten?1:0,e.isWildOp?1:0,e.mansen?1:0,e.cds?1:0,e.groupies?1:0,e.aantalBezoekers,e.gastdirigent,e.opmerkingen]).then(function(){return r.b(t,void 0,void 0,function(){var t;return r.e(this,function(n){switch(n.label){case 0:return e.stukken.length>0?(t=e.stukken.map(function(t){return"("+e.id+", "+t.id+")"}).join(", "),[4,this.sql.run("DELETE FROM optreden_repertoire WHERE optredenId="+e.id)]):[3,3];case 1:return n.sent(),[4,this.sql.run("INSERT INTO optreden_repertoire (optredenId, stukId) VALUES "+t)];case 2:n.sent(),n.label=3;case 3:return this.loadOptredens(),[2]}})})})},e.prototype.loadStukken=function(){var e=this;return this.sql.exec("SELECT * FROM stuk").then(function(t){var n=[];if(t.length>0)for(var r=0;r<t.length;r++)n.push({id:t[r].id,titel:t[r].titel,componist:t[r].componist,code:t[r].code,metSolist1:1===t[r].metSolist1,metSolist2:1===t[r].metSolist2});n.sort(s.a.dynamicSort("code")),e.stukken.next(n)}).catch(function(e){return console.error("yoyo",e)})},e.prototype.addStuk=function(e){var t=this;return this.sql.execWithVars("\n    INSERT INTO stuk (titel, componist, code, metSolist1, metSolist2)\n    VALUES (?, ?, ?, ?, ?)",[e.titel,e.componist,e.code,e.metSolist1?1:0,e.metSolist2?1:0]).then(function(){t.loadStukken()})},e.prototype.getStuk=function(e){return this.sql.exec("SELECT * FROM stuk WHERE id = '"+e+"'").then(function(e){return{id:e[0].id,titel:e[0].titel,componist:e[0].componist,code:e[0].code,metSolist1:1===e[0].metSolist1,metSolist2:1===e[0].metSolist2}})},e.prototype.getOptredenRepertoire=function(e){return this.sql.exec("\n    SELECT * FROM optreden_repertoire JOIN stuk ON optreden_repertoire.stukId = stuk.id\n    WHERE optreden_repertoire.optredenId = '"+e+"'").then(function(e){var t=[];if(e.length>0)for(var n=0;n<e.length;n++)t.push({id:e[n].id,titel:e[n].titel,componist:e[n].componist,code:e[n].code,metSolist1:1===e[n].metSolist1,metSolist2:1===e[n].metSolist2});return t.sort(s.a.dynamicSort("code")),t})},e.prototype.deleteStuk=function(e){var t=this;return this.sql.run("DELETE FROM stuk WHERE id = '"+e+"'").then(function(e){t.loadStukken(),t.loadOptredens()})},e.prototype.updateStuk=function(e){var t=this;return this.sql.execWithVars("UPDATE stuk SET titel = ?, componist = ?, code = ?, metSolist1 = ?, metSolist2 = ?\n    WHERE id = "+e.id,[e.titel,e.componist,e.code,e.metSolist1?1:0,e.metSolist2?1:0]).then(function(){t.loadStukken(),t.loadOptredens()})},e.prototype.getNumOptredensPerDag=function(){return this.sql.exec("SELECT count(*) AS numOptredens, datum FROM optreden GROUP BY datum").then(function(e){for(var t=[],n=0;n<e.length;n++)t.push({name:new Date(e[n].datum),value:e[n].numOptredens});return t})},e.prototype.getAverageOptredensPerDagVoorLand=function(e){return this.sql.exec("\n    SELECT avg(numOptredens) AS avgNumOptredens FROM\n    (SELECT count(*) AS numOptredens FROM optreden\n    WHERE landCode = '"+e+"' GROUP BY datum)").then(function(e){var t=e[0].avgNumOptredens;return null===t?0:t})},e.prototype.getNumOptredensVoorLand=function(e){return this.sql.exec("\n    SELECT count(*) AS numOptredens FROM optreden "+(e?"WHERE landCode = '"+e+"'":"")).then(function(e){var t=e[0].numOptredens;return null===t?0:t})},e.prototype.getPubliekVoorLand=function(e){return this.sql.exec("\n    SELECT sum(aantalBezoekers) AS aantalBezoekers FROM optreden "+(e?"WHERE landCode = '"+e+"'":"")).then(function(e){var t=e[0].aantalBezoekers;return null===t?0:t})},e.prototype.getPercentageWildopVoorLand=function(e){return this.sql.exec("\n    SELECT AVG(isWildOp) AS percentage FROM optreden "+(e?"WHERE landCode = '"+e+"'":"")).then(function(e){var t=e[0].percentage;return null===t?0:t})},e.prototype.getPercentageBuitenVoorLand=function(e){return this.sql.exec("\n    SELECT AVG(isBuiten) AS percentage FROM optreden "+(e?"WHERE landCode = '"+e+"'":"")).then(function(e){var t=e[0].percentage;return null===t?0:t})},e.prototype.getPercentageDoelgroepVoorLand=function(e,t){return this.sql.exec("\n    SELECT AVG("+e+") AS percentage FROM optreden "+(t?"WHERE landCode = '"+t+"'":"")).then(function(e){var t=e[0].percentage;return null===t?0:t})},e.prototype.getPercentageSolistenVoorLand=function(e,t){return this.sql.exec("\n    SELECT AVG(solist) AS percentage FROM\n    (SELECT MAX(stuk."+e+") AS solist FROM optreden_repertoire\n    JOIN optreden ON optreden.id = optredenId\n    JOIN stuk ON stuk.id = stukId\n    "+(t?"WHERE optreden.landCode = '"+t+"'":"")+"\n    GROUP BY optredenId)").then(function(e){var t=e[0].percentage;return null===t?0:t})},e.prototype.getAverageOptredensPerDag=function(){return this.getNumOptredensPerDag().then(function(e){var t;return(t=e.map(function(e){return e.value})).reduce(function(e,t){return e+t},0)/t.length})},e.prototype.getRicciottiCharts=function(e){var t=this;return this.sql.exec("\n    SELECT count(*) AS numOptredens, sum(aantalBezoekers) AS bezoekers, stukId FROM \n    (SELECT stukId, optreden.aantalBezoekers AS aantalBezoekers FROM optreden_repertoire\n    JOIN stuk ON stuk.id = stukId\n    JOIN optreden ON optreden.id = optredenId "+(e?"WHERE landCode = '"+e+"'":"")+")\n    GROUP BY stukId ORDER BY numOptredens DESC").then(function(e){return r.b(t,void 0,void 0,function(){var t,n,i;return r.e(this,function(r){switch(r.label){case 0:t=[],n=0,r.label=1;case 1:return n<e.length?[4,this.getStuk(e[n].stukId)]:[3,4];case 2:i=r.sent(),t.push(Object.assign(i,{optredens:e[n].numOptredens,bezoekers:e[n].bezoekers})),r.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})})},e.ngInjectableDef=p.T({factory:function(){return new e(p.X(i.Hb),p.X(h.c),p.X(c.a),p.X(l.a))},token:e,providedIn:"root"}),e}()}}]);